{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
<div class="dropdown dropdown-language">
    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {% for language in LANGUAGES %}
            {% if LANGUAGE_CODE == language.0 %}
                <img src="/static/img/{{ language.0 }}.png"
                     srcset="/static/img/{{ language.0 }}@2x.png 2x, /static/img/{{ language.0 }}@3x.png 3x"
                     alt=""
                />
            {% endif %}
        {% endfor %}
    </button>
    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
        {% for language in LANGUAGES %}
            {% if LANGUAGE_CODE == language.0 %}
                <a class="dropdown-item active" data-value="{{ language.0 }}" href="#">
                    <img src="/static/img/{{ language.0 }}.png"
                         srcset="/static/img/{{ language.0 }}@2x.png 2x, /static/img/{{ language.0 }}@3x.png 3x"
                         alt=""
                    /> {{ language.1 }}
                </a>
            {% endif %}
        {% endfor %}
        {% for language in LANGUAGES %}
            {% if LANGUAGE_CODE != language.0 %}
                <a class="dropdown-item" data-value="{{ language.0 }}" href="#">
                    <img src="/static/img/{{ language.0 }}.png"
                         srcset="/static/img/{{ language.0 }}@2x.png 2x, /static/img/{{ language.0 }}@3x.png 3x"
                         alt=""
                    /> {{ language.1 }}
                </a>
            {% endif %}
        {% endfor %}
    </div>
</div>
<form action="{% url 'set_language' %}" method="post" style="display:none;" id="language-form">{% csrf_token %}
    <input name="next" type="hidden" value="" id="next-input"/>
    <input type="text" name="language" id="language-input"/>
</form>
<script type="text/javascript">
    $(document).ready(function(){
    	var $languageForm = $('#language-form');
    	var $languageInput = $('#language-input');
    	var $nextInput = $('#next-input');
    	$('.dropdown-language .dropdown-item').click(function(){
            $languageInput.val($(this).data('value'));
            $nextInput.val('/');
            $languageForm.submit();
        });
    });
</script>
